## VLAN（虚拟局域网）
### 理论知识
- VLAN（Virtual Local Area Network） 是一种逻辑上的子网，可以在同一个物理网络中创建多个虚拟的广播域，进而增强网络的管理和安全性。VLAN通过将不同的物理端口划分到不同的VLAN中，来隔离广播流量、提高网络的安全性和效率。
- VLAN的工作原理：
    1. 在交换机中配置VLAN时，每个端口被分配到一个VLAN中。
    2. 每个VLAN都有一个独立的广播域。即使设备在同一台交换机上，只要属于不同VLAN，它们之间的广播和数据包不会直接相互传递。
    3. 通过**VLAN间路由**（通常通过三层交换机或路由器）实现不同VLAN之间的通信。
### VLAN的类型
- Access VLAN：普通的终端设备连接的VLAN，端口属于某个VLAN。
- Trunk VLAN：用于交换不同VLAN之间流量的链路。通常是交换机之间的连接，支持多个VLAN的标记。
### VLAN相关配置
#### 创建VLAN
```
[Huawei]vlan 10
[Huawei-vlan10]name mlishu
```
#### 将端口分配到VLAN
```
[Huawei]int gigabitethernet 0/0/1
[Huawei-GigabitEthernet0/0/1]port link-type access
[Huawei-GigabitEthernet0/0/1]port default vlan 10
```
#### 配置Trunk链路
```
[Huawei]int gigabitethernet 0/0/2
[Huawei-GigabitEthernet0/0/2]port link-type trunk
[Huawei-GigabitEthernet0/0/2]port trunk allow-pass vlan 10 20 30
```
## OSPF（开放最短路径优先）
### 理论知识
-OSPF（Open Shortest Path First）是一种内部网关协议（IGP），使用链路状态路由算法来确定最佳路径。OSPF通常用于大型网络中，具有快速的收敛能力，并且能够根据链路的成本来计算路由路径。
#### OSPF的工作原理：
1. 每个OSPF路由器通过发送**Hello**报文来发现邻居，并建立邻接关系。
2. 使用**LSA（Link-State Advertisement）**来传播路由信息，建立链路状态数据库（LSDB）。
3. 路由器根据LSDB来计算最佳路径，并使用SPF算法（Shortest Path First）得出最短路径树。
### OSPF区域：
Backbone Area（0号区域）：所有区域必须连接到0号区域。
普通区域：OSPF的常规区域。
Stub Area：简化区域，外部路由无法传播。
Totally Stubby Area：限制外部路由和部分内部路由的传播。
NSSA（Not So Stubby Area）：允许外部路由传播，但不完全开放。
### OSPF的配置
#### 启用OSPF
```
[Huawei]ospf 1
[Huawei-ospf-1]area 0
```

#### 配置接口OSPF
在接口上启用OSPF，并指定接口所在的区域：
```
[Huawei]int gigabitethernet 0/0/1
[Huawei-GigabitEthernet0/0/1]ospf network-type broadcast
[Huawei-GigabitEthernet0/0/1]ospf area 0
```
#### 配置OSPF路由器ID
```
[Huawei]ospf 1
[Huawei-ospf-1]router-id 1.1.1.1
```
#### 配置OSPF认证
配置OSPF的认证以确保邻居之间的安全通信：
```
[Huawei]int gigabitethernet 0/0/1
[Huawei-GigabitEthernet0/0/1]ospf authentication-mode md5 1 2 3 4
```
#### 查看OSPF邻居
```
[Huawei]display ospf peer
```
查看OSPF路由表
```
[Huawei]display ospf route
```
## VLAN间路由（Router-on-a-Stick）
当需要实现不同VLAN之间的通信时，通常会使用Router-on-a-Stick配置。这种配置需要一个三层交换机或者路由器通过Trunk链路连接到交换机，并配置子接口来分别为每个VLAN提供IP路由。
### 创建子接口并配置VLAN接口
```
[Huawei]int gigabitethernet 0/0/0.10
[Huawei-GigabitEthernet0/0/0.10]ip address 192.168.10.1 255.255.255.0
[Huawei-GigabitEthernet0/0/0.10]encapsulation dot1Q 10
```
### 配置Trunk链路
```
[Huawei]int gigabitethernet 0/0/1
[Huawei-GigabitEthernet0/0/1]port link-type trunk
[Huawei-GigabitEthernet0/0/1]port trunk allow-pass vlan 10 20
```
### OSPF区域互联配置示例
假设有两个路由器，并希望在不同的OSPF区域之间建立邻接关系：
#### Router 1 配置：
```
[Huawei]ospf 1
[Huawei-ospf-1]area 0
[Huawei-ospf-1]network 192.168.10.0 0.0.0.255 area 0
```
#### Router 2 配置：
```
[Huawei]ospf 1
[Huawei-ospf-1]area 1
[Huawei-ospf-1]network 192.168.20.0 0.0.0.255 area 1
```
这将使Router 1和Router 2分别在不同的OSPF区域（0号和1号区域）中建立邻接关系。
## 总结
VLAN的配置使得我们可以在同一个物理网络中创建多个虚拟的广播域，并通过路由器或三层交换机进行VLAN间的通信。
OSPF通过链路状态协议来传播路由信息，并使用SPF算法计算最佳路径。它可以通过配置不同的区域来优化网络结构。
Router-on-a-Stick提供了一个通过单一物理接口进行多个VLAN之间路由的方法。