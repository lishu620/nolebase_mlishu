## BGP基本配置
### 特点
1.BGP的主要特点是路由的传递，而非路由的学习。只要两个路由器之间TCP可达，就可以建立BGP关系
2.建立BGP邻居的时候采用的本段地址就是TCP的源地址。通常分为物理接口IP地址和Loopback地址，物理地址常用于EBGP，Loopback地址常用于IBGP
3.通过Loopback地址建立邻居关系需要声明用的本地接口
```
bgp 100
peer 2.2.2.2 as-number 200
```
4.BGP的发布
```
bgp 100
network 192.168.1.0 24
import-route ospf
```
### 路由通告原则
1.只通告最优且有效的路由给对等体
2.来源于EBGP的路由可以通告给所有对等体，通告给EBGP的路由无需更新源地址，而通告给IBGP的路由需要更新源地址
```
[AR-bgp]peer 2.2.2.2 next-hop-local
```
## BGP路径属性
### 属性类型
1.公认必遵：传递BGP路由的时候一定要携带属性（Origin、AS_Path、Next_hop）
2.公认任意：传递BGP路由的时候携带属性，可以不携带属性
3.可选过渡：传递BGP路由的时候如果携带了某个属性，传递给另外的路由器，该路由器不能识别该属性，它**也可以**把这条BGP路由传递给下一个路由器
4.可选非过渡：传递BGP路由的时候如果携带了某个属性，传递给另外的路由器，该路由器不能识别该属性，它**不能**把这条BGP路由传递给下一个路由器

#### AS-Path
BGP 路由在传递过程中，会记录经过的 AS（自治系统）号。AS 内部传递（即 iBGP）不会修改或增加 AS-Path 记录，只有路由在不同 AS 之间传播（eBGP）时，才会在 AS-Path 中增加自己的 AS 号。
AS-Path 的作用如下：
防止路由环路（Loop Prevention）
当一个 BGP 路由器收到包含自己 AS 号的路由时，会直接丢弃该路由。
这样可以防止路由在多个 AS 之间来回传递，形成环路。
路径选择依据（Path Selection）
BGP 在多条到同一目的地的路由之间进行选择时，会优先选择 AS-Path 最短 的路由。
AS-Path 越短，表示路径经过的 AS 越少，通常认为路径更“优”。
实现路由策略控制（Policy Control）
网络管理员可以根据 AS-Path 内容来 过滤路由 或 设置路由优先级。
例如，可以通过 ip as-path access-list 或 route-policy 匹配特定的 AS 序列，从而控制哪些路由可以被接受或传播。
#### Origin
BGP的路由通过network的方式发布、通过其他EGP（外部网络路由协议）路由学习以及通过import-route发布。这三种方式的起源在BGP属性特征中用符号表示，分别是I、E、？。作用如下：
1.通过起源属性可以知道BGP的来源
2.选路原则：I>E>?
#### Next-Hop
下一跳属性的原则
1.来源于EBGP的路由可以通告给所有对等体，通告给EBGP的路由会自动更新源地址
2.开源与EBGP的路由通告给IBGP邻居，不会自动更新源地址，会导致路由不可用，需要手动更新源地址
```
peer 2.2.2.2 next-hop-local
```
#### Local_Preference和MED属性选路的区别
1.Local-Preference的值越大越优先，MED越小越优先
2.Local-Preference用于AS内部，MED用于AS之间
3.Local-Preference用于AS内选择出口，MED用于AS间选择入口
注意事项：
1.该值通过network和import-route命令发布的BGP路由默认值为100
2.MED值在初始EBGP之间传递有效，再次传递给另外的EBGP邻居无效，在IBGP之间也可以传递（无效传递），值不变
3.默认情况下只比较来自于同一个AS的MED值，若要比较来自不同AS的MED，需要通过命令设置
```
compare-deferent-as-med
```
4.通过network和import-route命令发布的BGP路由，若该路由原来是属于OSPF或ISIS协议，则MED值继承原有OSPF和ISIS中的cost值，若该路由原来是静态或直连路由，则MED值为0
#### Atomic_Aggregate
在聚合的BGP路由上会添加该标志，只有当明细路由被抑制，只有聚合之后才会添加该标志
#### Aggregator
表示聚合发生的AS号和发生的路由器RouteID
```
aggregate 10.1.0.0 255.255.0.0 detail-suppressed 
```
![[Pasted image 20251106113605.png]]

![[Pasted image 20251106113630.png]]

## 配置AS-PATH
```
aggregate 10.1.0.0 255.255.0.0 detail-suppressed as-set
```

![[Pasted image 20251106113728.png]]

![[Pasted image 20251106113751.png]]

## 停止通告

![[Pasted image 20251106113845.png]]




