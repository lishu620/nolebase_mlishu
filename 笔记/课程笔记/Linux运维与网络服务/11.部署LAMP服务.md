## 部署Discuz
### 准备步骤
```
wget https://gitee.com/Discuz/DiscuzX/attach_files/2335009/download
mv download discuz.zip
unzip discuz.zip
```
文件目录如下
```
[root@localhost ~]# ls -l
total 11464
-rw-------.  1 root root     1043 Nov 22 09:38 anaconda-ks.cfg
-rw-r--r--   1 root root 11606700 Dec 15 08:51 discuz.zip
-rw-r--r--   1 root root     8181 Aug 29 21:39 LICENSE
-rw-r--r--   1 root root    33294 Dec 21  2022 qqqun.png
drwxr-xr-x   2 root root      124 Sep  2 15:58 readme
-rw-r--r--   1 root root    70226 Mar 16  2023 readme.html
drwxr-xr-x  12 root root     4096 Sep  2 15:58 upload
-rw-r--r--   1 root root      140 Feb 12  2023 utility.html
```
将upload复制到/usr/local/apache/htdocs/discuz
```
cp -R upload/ /usr/local/apache/htdocs/discuz
```
### 创建数据库
```
CREATE DATABASE discuz;
GRANT all ON discuz.* TO discuz@localhost IDENTIFIED BY '123456';
quit;
```
### 修改文件权限并重启服务
```
chown -R daemon /usr/local/apache/htdocs/discuz/
systemctl restart httpd
```
登录网页并修改数据库信息
![[Pasted image 20251215220910.png]]
## 部署phpMyAdmin
### 准备步骤
```
scp phpMyAdmin-5.2.3-all-languages.zip root@10.169.169.201:/root
```

```
unzip phpMyAdmin-5.2.3-all-languages.zip
mv phpMyAdmin-5.2.3-all-languages /usr/local/apache/htdocs/phpmyadmin
cd /usr/local/apache/htdocs/
chown -R daemon phpmyadmin/
```
### 修改配置文件
```
cp phpmyadmin/config.sample.inc.php phpmyadmin/config.inc.php
vi phpmyadmin/config.inc.php
```
查找套接字文件
```
find / -name "mysql.sock" 2>/dev/null
```
一般结果为：`/var/lib/mysql/mysql.sock`
修改这一行如下
```
$cfg['blowfish_secret'] = 'admin@123';
$cfg['Servers'][$i]['socket'] = '/var/lib/mysql/mysql.sock';
```
重启服务
```
systemctl restart httpd
```
## 配置虚拟主机
### 修改配置文件
```
vi /usr/local/apache/conf/httpd.conf
```
将下面行前面的`#`去掉
```
Include conf/extra/httpd-vhosts.conf
```

### 修改虚拟主机配置文件
```
vi /usr/local/apache/conf/extra/httpd-vhosts.conf
```
配置如下
```
<VirtualHost *:80>
        DocumentRoot "/usr/local/apache/htdocs/discuz"
        ServerName bbs.luyuhao.com

        ErrorLog "logs/bbs.luyuhao.com-error_log"
        CustomLog "logs/bbs.luyuhao.com-access_log" common

        <Directory "/usr/local/apache/htdocs/discuz">
                Options Indexes FollowSymLinks
                AllowOverride All
                Require all granted
        </Directory>
</VirtualHost>

<VirtualHost *:80>
        DocumentRoot "/usr/local/apache/htdocs/phpmyadmin"
        ServerName db.luyuhao.com

        ErrorLog "logs/db.luyuhao.com-error_log"
        CustomLog "logs/db.luyuhao.com-access_log" common

        <Directory "/usr/local/apache/htdocs/phpmyadmin">
                Options Indexes FollowSymLinks
                AllowOverride All
                Require all granted
        </Directory>
</VirtualHost>
```
添加对应的DNS解析到主机
